{
  "$schema": "https://raw.githubusercontent.com/invoiceradar/plugins/main/schema.json",
  "id": "backlinked",
  "name": "Backlinked",
  "description": "Backlink monitoring and management platform",
  "homepage": "https://backlinked.com",
  "configSchema": {},
  "checkAuth": [
    {
      "action": "navigate",
      "url": "https://app.backlinked.com/dashboard"
    },
    {
      "action": "checkURL",
      "url": "https://app.backlinked.com/dashboard"
    }
  ],
  "startAuth": [
    {
      "action": "navigate",
      "url": "https://app.backlinked.com/login"
    },
    {
      "action": "waitForURL",
      "url": "https://app.backlinked.com/dashboard"
    }
  ],
  "getDocuments": [
    {
      "action": "navigate",
      "url": "https://app.backlinked.com/account/payments",
      "waitForNetworkIdle": true
    },
    {
      "action": "extractAll",
      "selector": "a[href^='/payments/']",
      "forEach": [
        {
          "action": "if",
          "script": "'{{item.status}}' === 'Abgeschlossen'",
          "then": [
            {
              "action": "downloadPdf",
              "url": "https://app.backlinked.com/api/payments/{{item.id}}/confirmation",
              "document": {
                "id": "{{item.id}}",
                "date": "{{item.date}}",
                "total": "{{item.amount}}"
              }
            }
          ]
        }
      ],
      "fields": {
        "id": {
          "selector": "div:first-child",
          "transform": "(text) => text.trim()"
        },
        "date": {
          "selector": "div:nth-child(2)",
          "transform": "(text) => text.trim()"
        },
        "amount": {
          "selector": "div:nth-child(6)",
          "transform": "(text) => text.replace('â‚¬', '').trim()"
        },
        "status": {
          "selector": "div:nth-child(3) > div",
          "transform": "(text) => text.trim()"
        }
      }
    }
  ]
}
